from email import message
import logging, random, time
from aiogram import Bot, Dispatcher, executor, types
from aiogram.dispatcher.filters import Text
from parse_site import weather_sinoptic
from token_pass import API_TOKEN

class TimerHelp():
    def __init__(self):
        self.start_time = 0
    
    def set_now_time(self):
        self.start_time = time.time()

# API_TOKEN = code_data.read("mydata", input("password"))

# Configure logging
logging.basicConfig(level=logging.INFO)

# Initialize bot and dispatcher
bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

async def on_startup():
    user_should_be_notified = -702529372
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    buttons = ["–ø–æ–≥–æ–¥–∞ –û–¥–µ—Å—Å–∞", "Game"]
    keyboard.add(*buttons)
    await bot.send_message(user_should_be_notified, "–ë–æ—Ç –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω")

def get_keyboard():
    # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª–∞–≤–∏–∞—Ç—É—Ä—ã.
    keyboard = types.InlineKeyboardMarkup()
    buttons = [
        types.InlineKeyboardButton(text="racoon", callback_data="racoon"),
        types.InlineKeyboardButton(text="dog", callback_data="dog"),
        types.InlineKeyboardButton(text="seagull", callback_data="seagull"),
        types.InlineKeyboardButton(text="squirrel", callback_data="squirrel"),
        types.InlineKeyboardButton(text="cat", callback_data="cat"),
        types.InlineKeyboardButton(text="fox", callback_data="fox")
    ]
    # –ë–ª–∞–≥–æ–¥–∞—Ä—è row_width=2, –≤ –ø–µ—Ä–≤–æ–º —Ä—è–¥—É –±—É–¥–µ—Ç –¥–≤–µ –∫–Ω–æ–ø–∫–∏, –∞ –æ—Å—Ç–∞–≤—à–∞—è—Å—è –æ–¥–Ω–∞
    # —É–π–¥—ë—Ç –Ω–∞ —Å–ª–µ–¥—É—é—â—É—é —Å—Ç—Ä–æ–∫—É
    keyboard = types.InlineKeyboardMarkup(row_width=2)
    keyboard.add(*buttons)
    return keyboard

@dp.message_handler(commands=['start', 'help'])
async def send_welcome(message: types.Message):
    keyboard = types.ReplyKeyboardMarkup(resize_keyboard=True)
    buttons = ["–ø–æ–≥–æ–¥–∞ –û–¥–µ—Å—Å–∞", "Game"]
    keyboard.add(*buttons)
    await message.reply("Hi!\nI'm Bot!\nI'm type some statements\nYou type words: –º—ã—Å–ª—å, –∏–¥–µ—è, thought, idea, cat", reply_markup=keyboard)

@dp.message_handler(text="Game")
async def start_game(message: types.Message):
    await message.answer("–í—ã–±–µ—Ä–µ—Ç–∏ –∂–∏–≤–æ—Ç–Ω–æ–µ", reply_markup=get_keyboard())

@dp.callback_query_handler(text='racoon')
async def start_game(call: types.CallbackQuery):
    with open('data/racoon.jpeg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Racoon is here', reply_markup=get_keyboard())
    await call.answer()

@dp.callback_query_handler(text='dog')
async def start_game(call: types.CallbackQuery):
    with open('data/dog.jpg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Dog is here', reply_markup=get_keyboard())
    await call.answer()

@dp.callback_query_handler(text='seagull')
async def start_game(call: types.CallbackQuery):
    with open('data/seagull.jpg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Seagull is here', reply_markup=get_keyboard())
    await call.answer()

@dp.callback_query_handler(text='squirrel')
async def start_game(call: types.CallbackQuery):
    with open('data/squirrel.jpeg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Sqaull is here', reply_markup=get_keyboard())
    await call.answer()

@dp.callback_query_handler(text='cat')
async def start_game(call: types.CallbackQuery):
    with open('data/mother_in_low_cat.jpg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Cats is here', reply_markup=get_keyboard())
    await call.answer()

@dp.callback_query_handler(text="fox")
async def start_game(call: types.CallbackQuery):
    with open('data/fox.jpg', 'rb') as photo:
        await call.message.reply_photo(photo, caption='Fox is here', reply_markup=get_keyboard())
    await call.answer()

text_all_time=('–º—ã—Å–ª—å', 'thought')
STATEMENTS= (
    '–ß–µ–ª–æ–≤–µ—á–µ—Å–∫–∏–π –º–æ–∑–≥ ‚Äì –≤–µ–ª–∏–∫–æ–ª–µ–ø–Ω–∞—è —à—Ç—É–∫–∞. –û–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–æ —Ç–æ–π —Å–∞–º–æ–π –º–∏–Ω—É—Ç—ã, –∫–æ–≥–¥–∞ —Ç—ã –≤—Å—Ç–∞–µ—à—å, —á—Ç–æ–±—ã –ø—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏ —Ä–µ—á—å.',
    '–û–Ω–∏ –ø—Ä–æ—á–ª–∏ –ª–µ–∫—Ü–∏—é –Ω–∞—Å—á–µ—Ç —Ç—Ä–µ–∑–≤–æ—Å—Ç–∏, –Ω–æ –≤—ã—Ä—É—á–∏–ª–∏ —Ç–∞–∫–∏–µ –≥—Ä–æ—à–∏, —á—Ç–æ –¥–∞–∂–µ –Ω–∞ –≤—ã–ø–∏–≤–∫—É –Ω–µ —Ö–≤–∞—Ç–∏–ª–æ.',
    '–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–ø–æ—Ä—å—Ç–µ —Å –∏–¥–∏–æ—Ç–∞–º–∏. –í—ã –æ–ø—É—Å—Ç–∏—Ç–µ—Å—å –¥–æ –∏—Ö —É—Ä–æ–≤–Ω—è, –≥–¥–µ –æ–Ω–∏ –≤–∞—Å –∑–∞–¥–∞–≤—è—Ç —Å–≤–æ–∏–º –æ–ø—ã—Ç–æ–º.',
    '–ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–æ—Ä–æ–≤—å–µ ‚Äî —ç—Ç–æ –µ—Å—Ç—å —Ç–æ, —á–µ–≥–æ –Ω–µ —Ö–æ—á–µ—à—å, –ø–∏—Ç—å —Ç–æ, —á–µ–≥–æ –Ω–µ –ª—é–±–∏—à—å, –∏ –¥–µ–ª–∞—Ç—å —Ç–æ, —á—Ç–æ –Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è.',
    '–†–∞–±–æ—Ç–∞–π—Ç–µ —Ç–∞–∫, —Å–ª–æ–≤–Ω–æ –¥–µ–Ω—å–≥–∏ –Ω–µ –∏–º–µ—é—Ç –¥–ª—è –í–∞—Å –Ω–∏–∫–∞–∫–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.',
    '–Ø –∫–æ–≥–¥–∞-—Ç–æ —Ä–∞–±–æ—Ç–∞–ª –Ω–∞ –∑–æ–ª–æ—Ç—ã—Ö –ø—Ä–∏–∏—Å–∫–∞—Ö –∏ –∑–Ω–∞—é –≤—Å–µ –æ –¥–æ–±—ã—á–µ –∑–æ–ª–æ—Ç–∞, –∫—Ä–æ–º–µ –ª–∏—à—å –æ–¥–Ω–æ–≥–æ: –∫–∞–∫ –∑–∞—Ä–∞–±–æ—Ç–∞—Ç—å —Ç–∞–º –¥–µ–Ω—å–≥–∏.',
    '–õ–µ—Ç–æ ‚Äî —ç—Ç–æ –≤—Ä–µ–º—è –≥–æ–¥–∞, –∫–æ–≥–¥–∞ –æ—á–µ–Ω—å –∂–∞—Ä–∫–æ, —á—Ç–æ–±—ã –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –≤–µ—â–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–º–∏ –∑–∞–Ω–∏–º–∞—Ç—å—Å—è –∑–∏–º–æ–π –±—ã–ª–æ –æ—á–µ–Ω—å —Ö–æ–ª–æ–¥–Ω–æ.',
    '–ï—Å–ª–∏ –≤—ã –Ω–µ —á–∏—Ç–∞–µ—Ç–µ –≥–∞–∑–µ—Ç ‚Äî –≤—ã –Ω–µ–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã. –ï—Å–ª–∏ –≤—ã —á–∏—Ç–∞–µ—Ç–µ –≥–∞–∑–µ—Ç—ã ‚Äî –≤—ã –¥–µ–∑–∏–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω—ã.'
)

for i in text_all_time:
    @dp.message_handler(text_contains=i)
    async def text_contains_any_handler(message: types.Message):
        random_statments = random.randint(0, len(STATEMENTS)-1)
        await message.answer(STATEMENTS[random_statments])

text_in_period=('–∏–¥–µ—è', 'idea')
data_time = TimerHelp()

for i in text_in_period:
    @dp.message_handler(text_contains=i)
    async def text_contains_any_handler(message: types.Message):
        difference = time.time() - data_time.start_time
        if difference > 10:
            data_time.set_now_time()
            random_statment = random.randint(0, len(STATEMENTS)-1)
            await message.answer(STATEMENTS[random_statment])

@dp.message_handler(Text(equals="–ø–æ–≥–æ–¥–∞ –û–¥–µ—Å—Å–∞"))
async def with_puree(message: types.Message):
    await message.answer(weather_sinoptic())


@dp.message_handler(regexp='(^cat[s]?)')
async def cats(message: types.Message):
    with open('data/cats.jpg', 'rb') as photo:
        await message.reply_photo(photo, caption='Cats are here üò∫')


if __name__ == '__main__':
    executor.start(dp, on_startup())
    executor.start_polling(dp, skip_updates=True)
    